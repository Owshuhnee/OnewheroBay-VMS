@model IEnumerable<VMS.WebApp.Models.Booking>

@{
    ViewData["Title"] = "My Bookings";
}

<div class="tickets-page">

    <!-- HEADER / HERO STRIP -->
    <section class="tickets-hero">
        <h1>My Bookings</h1>
        <p>
            Here are your active tickets for Onewhero Bay Heritage Park.
            Show the QR code at the entrance when you arrive.
        </p>
    </section>

    @if (Model != null && Model.Any())
    {
        <!-- LIST OF TICKETS -->
        <section class="tickets-list">

            @foreach (var b in Model)
            {
                var eventName = b.Event?.EventName ?? "Event";
                var date = b.BookingDate.ToString("dd MMM yyyy");
                var time = b.BookingTime.ToString(@"hh\:mm");
                var status = (b.BookingStatus ?? "pending").ToLowerInvariant();
                var qrUrl = Url.Action("TicketQr", "BookingsFE", new { id = b.BookingId });

                <article class="ticket-card ticket-status-@status">

                    <!-- LEFT SIDE: TEXT DETAILS -->
                    <div class="ticket-main">
                        <header class="ticket-header">
                            <h2>@eventName</h2>
                            <span class="ticket-status-badge">
                                @b.BookingStatus
                            </span>
                        </header>

                        <dl class="ticket-meta">
                            <div class="ticket-meta-row">
                                <dt>Booking #</dt>
                                <dd>@b.BookingId</dd>
                            </div>
                            <div class="ticket-meta-row">
                                <dt>Date</dt>
                                <dd>@date</dd>
                            </div>
                            <div class="ticket-meta-row">
                                <dt>Time</dt>
                                <dd>@time</dd>
                            </div>
                            <div class="ticket-meta-row">
                                <dt>Guests</dt>
                                <dd>@b.GuestCount</dd>
                            </div>
                            <div class="ticket-meta-row">
                                <dt>Total</dt>
                                <dd>@b.TotalPrice.ToString("C")</dd>
                            </div>
                        </dl>
                    </div>

                    <!-- RIGHT SIDE: QR + ACTIONS -->
                    <div class="ticket-qr-area">
                        <div class="ticket-qr-wrapper">
                            <img src="@qrUrl"
                                 alt="QR code for booking @b.BookingId"
                                 class="ticket-qr-img" />
                        </div>

                        <a href="@qrUrl"
                           download="booking-@b.BookingId-qr.png"
                           class="ticket-link">
                            Download QR
                        </a>

                        <a asp-controller="BookingsFE"
                           asp-action="Confirmation"
                           asp-route-id="@b.BookingId"
                           class="ticket-link ticket-link-secondary">
                            View booking details
                        </a>
                    </div>

                </article>
            }

        </section>
    }
    else
    {
        <section class="tickets-empty">
            <h2>You don’t have any active bookings yet.</h2>
            <p>Ready to plan your visit?</p>
            <a asp-controller="EventsFE" asp-action="Index" class="btn btn-primary">
                Browse events
            </a>
        </section>
    }
</div>
